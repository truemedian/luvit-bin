diff --color -ru -x.git -xbuild src/luvi/CMakeLists.txt src/luvi.1/CMakeLists.txt
--- src/luvi/CMakeLists.txt	2021-08-21 14:17:06.818159695 -0500
+++ src/luvi.1/CMakeLists.txt	2021-08-21 14:15:59.590079097 -0500
@@ -100,12 +100,13 @@
   include_directories(deps/luv/deps/libuv/include)
   if (WITH_LUA_ENGINE STREQUAL Lua)
     include_directories(deps/luv/deps/lua)
-    set(LUVI_LIBRARIES libluv_a lualib uv_a)
+    set(LUVI_LIBRARIES libluv_a lualib)
   else()
     include_directories(deps/luv/deps/luajit/src)
-    set(LUVI_LIBRARIES libluv_a luajit-5.1 uv_a)
+    set(LUVI_LIBRARIES libluv_a luajit-5.1)
   endif()
   add_subdirectory(deps/luv)
+  set(LUVI_LIBRARIES ${LUVI_LIBRARIES} ${LIBUV_LIBRARIES})
 endif (WithSharedLibluv)
 
 set(LUA_COMPAT53_DIR deps/luv/deps/lua-compat-5.3)
@@ -124,7 +125,7 @@
 endif (WithPCRE)
 
 if (WithLPEG)
-  set(LPEGLIB_DIR ${CMAKE_CURRENT_SOURCE_DIR}/deps/lpeg)
+  set(LPEGLIB_DIR deps/lpeg)
   if(DEFINED ENV{LPEGLIB_DIR})
     set(LPEGLIB_DIR $ENV{LPEGLIB_DIR})
   endif()
Only in src/luvi: CMakeLists.txt.orig
diff --color -ru -x.git -xbuild src/luvi/Makefile src/luvi.1/Makefile
--- src/luvi/Makefile	2021-08-21 14:17:06.818159695 -0500
+++ src/luvi.1/Makefile	2021-08-21 14:08:10.035519852 -0500
@@ -75,7 +75,7 @@
 
 # Configure the build with shared openssl
 regular-shared:
-	cmake $(CMAKE_FLAGS) $(CPACK_FLAGS) -DWithOpenSSL=ON -DWithSharedOpenSSL=ON -DWithPCRE=ON -DWithLPEG=ON -DWithSharedPCRE=OFF
+	cmake $(CMAKE_FLAGS) $(CPACK_FLAGS) -DWithOpenSSL=ON -DWithSharedOpenSSL=ON -DWithPCRE=ON -DWithLPEG=ON
 
 package: deps/luv/CMakeLists.txt
 	cmake --build build -- package
Only in src/luvi: Makefile.orig
